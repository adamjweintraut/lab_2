---
title: "The Effect of Lead Actor's Gender and Movie Title on Gross Earnings"
author: 'Group 4 - Ronald Lee, Lawrence Jiang, Adam Weintraut, Victor Ramirez'
date: "April 4, 2022"
output:
  pdf_document:
    toc: true
    toc_depth: 3
urlcolor: blue    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, echo=FALSE}

library(dplyr)
library(ggplot2)
library(tidyr)
library(scales)
library(stargazer)

get_robust_se <- function(model) { 
    require(sandwich)
    
    sqrt(diag(sandwich::vcovHC(model)))
}

#https://stackoverflow.com/questions/12590180/inflation-adjusted-prices-package
# install.packages("quantmod")
library(quantmod)

# getSymbols("CPIAUCSL", src='FRED') #Consumer Price Index for All Urban Consumers: All Items

```

```{r warning=FALSE, message=FALSE, echo=FALSE}

movies_cast_gender <- read.csv("datasets/movies_cast_gender.csv")

movies_cast_gender <- movies_cast_gender %>%
  mutate(gender_str = case_when(
    gender == 1 ~ "female",
    gender == 2 ~ "male"
  ))

movies_dataset <- movies_cast_gender[, c("name", "score", "year","votes","budget","gross", "net_profit",
                                        "runtime", "gender", "genre", "genre_", "rating_", "director_",
                                        "writer_", "star_", "country_", "company_",
                                        "female_indicator")]

movies_dataset <- movies_dataset[!is.na(movies_dataset$score), ]
movies_dataset <- movies_dataset[!is.na(movies_dataset$year), ]
movies_dataset <- movies_dataset[!is.na(movies_dataset$votes), ]
movies_dataset <- movies_dataset[!is.na(movies_dataset$budget), ]
movies_dataset <- movies_dataset[!is.na(movies_dataset$gross), ]
movies_dataset <- movies_dataset[!is.na(movies_dataset$runtime), ]
# movies_dataset$genre_f <- factor(movies_dataset$genre, ordered=FALSE)

# movies_title_sim <- read.csv("datasets/movie_title_sim_all.csv")
# 
# movies_title_sim <- movies_title_sim[, c("name", "title_unique_score")]

# movies_dataset <- inner_join(movies_dataset, movies_title_sim, by = c("name" = "name"))

# Adjust Gross and Budget for inflation
# avg.cpi <- apply.yearly(CPIAUCSL, mean)
# 
# # our data starts from 1980
# cf <- avg.cpi/as.numeric(avg.cpi['1980'])
# 
# dcf <- data.frame(cf)
# dcf$year <- rownames(dcf)
# dcf$year <- as.numeric(format(as.Date(dcf$year, format="%Y-%m-%d"),"%Y"))
# colnames(dcf)[1] <- "cpi"
# 
# write.csv(dcf,"datasets/cpi.csv", row.names = FALSE)

cpi <- read.csv("datasets/cpi.csv")

movies_dataset <- inner_join(movies_dataset, cpi, by = c("year" = "year"))

movies_dataset$adj_gross <- movies_dataset$gross * movies_dataset$cpi
movies_dataset$adj_gross <- round(movies_dataset$adj_gross)

movies_dataset$adj_budget <- movies_dataset$budget * movies_dataset$cpi
movies_dataset$adj_budget <- round(movies_dataset$adj_budget)

# write.csv(movies_dataset,"datasets/movies_dataset_cpi.csv", row.names = FALSE)

# We later use python to generate data for title similarities and export it to 'max_title_sim.csv'
# and join it with our "movies_dataset_cpi.csv" above

movies_title_sim <- read.csv("datasets/movies_title_sim.csv")
movies_title_sim <- movies_title_sim[, c("name", "max_title_similarity2")]
movies_title_sim <- movies_title_sim %>%
  mutate(max_title_similarity = max_title_similarity2)

movies_dataset <- inner_join(movies_dataset, movies_title_sim, by = c("name" = "name"))

# Add indicator on movies duration > 2 hours
movies_dataset$runtime_hrs = movies_dataset$runtime / 60
movies_dataset <- movies_dataset %>%
   mutate(is_longer_than_2hrs = case_when(
      runtime_hrs >= 2 ~ 1,
      runtime_hrs < 2 ~ 0
  ))

## Genre Indicators. Only selected the top 8 genres with number of movies > 100
movies_dataset <- movies_dataset %>%
   mutate(is_genre_comedy = case_when(
      genre == "Comedy" ~ 1,
      genre != "Comedy" ~ 0
  ))

movies_dataset <- movies_dataset %>%
   mutate(is_genre_action = case_when(
      genre == "Action" ~ 1,
      genre != "Action" ~ 0
  ))

movies_dataset <- movies_dataset %>%
   mutate(is_genre_drama = case_when(
      genre == "Drama" ~ 1,
      genre != "Drama" ~ 0
  ))

movies_dataset <- movies_dataset %>%
   mutate(is_genre_crime = case_when(
      genre == "Crime" ~ 1,
      genre != "Crime" ~ 0
  ))

movies_dataset <- movies_dataset %>%
   mutate(is_genre_adventure = case_when(
      genre == "Adventure" ~ 1,
      genre != "Adventure" ~ 0
  ))

movies_dataset <- movies_dataset %>%
   mutate(is_genre_biography = case_when(
      genre == "Biography" ~ 1,
      genre != "Biography" ~ 0
  ))

movies_dataset <- movies_dataset %>%
   mutate(is_genre_animation = case_when(
      genre == "Animation" ~ 1,
      genre != "Animation" ~ 0
  ))

movies_dataset <- movies_dataset %>%
   mutate(is_genre_horror = case_when(
      genre == "Horror" ~ 1,
      genre != "Horror" ~ 0
  ))

```


# 1. Introduction

## 1.1 Motivation
Movies have been in existence since 1888. Since then, watching movies has been one of our favorite pastimes. Movies are a form of blending visual and sound communication to tell a vivid story. 

The movie entertainment industry is a high profile multi-billion-dollar global industry. The movie industry has exponentially grown over the past decades. With this growth there has come a windfall of revenue generating profits. As technology evolves and enhances the viewing experience, you can watch movies from various devices. People can enjoy movies in the comfort of their homes or while traveling. 

The ability to predict movie revenue can be a very insightful opportunity. With the predicted revenue information, movie makers can intelligently plan their movie budget. Movie budget line items including star salaries, production, and distribution costs can be smartly negotiated and set. 

\newpage
## 1.2 Research Question

The success or failure of a movie depends on a variety of different factors: star cast, cast gender, budget, and title. With the breadth of data available today, making accurate revenue predictions is extremely difficult. However, we do have many data science tools and methodologies at our disposal to help in attempting to make movie revenue predictions. 

Our research question is:\
\
_How the Lead actor's gender affect a movie's gross revenue?_
\

In this study we will explore the relationship between the following features, cast gender, budget, runtime, and title. First, to harness the power of the regression testing harness we engineered three linear regression models to predict the movie revenue. Second, we engineer the model using various data features. We iterated over different features including the following extracted features, cast gender, budget, runtime, and title. Third, we collected various types of datasets from different freely open sources. We then joined and sanitized the data for inspections and prediction modeling. 

# 2. Description of the Data and Research Design

```{r , out.width="70%", warning=FALSE, message=FALSE, echo=FALSE}
# After you have presented the introduction and the concepts that are under investigation, what data are you going to use to answer the questions? What type of research design are you using? What type of models are you going to estimate, and what goals do you have for these models?  
```  

We use two datasets for our analysis:

**IMDb dataset** ([url](https://www.kaggle.com/datasets/danielgrijalvas/movies)):
For this dataset, the data that we are interested in are the movie title, budget, and gross. Budget and Gross are in US dollar.

**Movie roles by gender** ([url](https://www.kaggle.com/code/martinellis/exploration-of-movie-roles-by-gender/notebook)):
This dataset has the gender info for movie actors. The source has instructions on how to execute R code to parse the original data file, which has data in JSON format, and convert it into CSV format that can be imported to R studio. The values of gender is either a value of 2 for "Male", or 1 for "Female".

With this two datasets, we then perform an inner-join on them by their movie lead actor name to generate a single dataset that has all the movie info plus lead actor's gender info.

Before we perform our analysis, we also clean up the data by removing all the entries that have empty values for the fields that we are interested (budget, gross, runtime). The final dataset has over 5000 rows of movie data.

In addition, we also generate a "max_title_similarity" to generate a data for how similar a movie title to the rest of the movies in the dataset.

Finally, we uses a R package called 'quantmod' to retrieve CPI data for inflation adjustment for our Gross and Budget data. Then we perform adjustment to the Gross and Budget data in our main dataset. We use 1980 as the base year for our inflation adjustment, then perform inner-join with the main dataset by the years. Additional calculations to adjust Gross and Budget are performed afterwards and added as columns to the main dataset.

## 2a. Data Characteristics
In this section we take a look at the data characteristics for our variables that we are interested and see if there is any need to perform cleanup or transformation before we build our models.\
\


```{r , out.width="70%", warning=FALSE, message=FALSE, echo=FALSE}
ggplot(movies_dataset, aes(adj_budget)) + 
  geom_histogram(position="dodge", alpha=0.8) +
  ggtitle("Distribution of Movie Budgets (Adjusted for inflation)")+
  scale_x_continuous(labels = comma)
```
\
Movie Budget is highly skewed to the left which means most movies have relatively low budget, and there are only a few movies that have really high budget.
\
```{r , out.width="70%", warning=FALSE, message=FALSE, echo=FALSE}
ggplot(movies_dataset, aes(adj_gross)) + 
  geom_histogram(position="dodge", alpha=0.8) +
  ggtitle("Distribution of Movie Gross Earnings (Adjusted for inflation)")+
  scale_x_continuous(labels = comma)
```
\
Movie Gross Earnings has similar characteristics as the budget, also highly skewed to the low end.
\
```{r , out.width="70%", warning=FALSE, message=FALSE, echo=FALSE}
ggplot(movies_dataset, aes(gender)) + 
  geom_histogram(position="dodge", alpha=0.8, binwidth = 0.5) +
  ggtitle("Lead Actor's Gender")
```
\
In this histogram that shows the number of Male versus Female Lead Actor. The value "2.0" represent 'Male', and you can see that there are much more Male lead actors in our movie dataset.
\

```{r warning=FALSE, message=FALSE, echo=FALSE}

ggplot(movies_dataset, aes(max_title_similarity)) + 
  geom_histogram(position="dodge", alpha=0.8) +
  ggtitle("Distribution of Movie Max Title Similarity")+
  scale_x_continuous(labels = comma)

```
\
The Max Title Similarity score has 3 spikes. The biggest one is at the 0 score, the two small ones at around 0.125 and 1. The data near the middle of the range has a bell shape similar to a normal distribution.
\


\newpage

# 3. Modeling

```{r warning=FALSE, message=FALSE, echo=FALSE}
# You will next build a set of models to investigate your research question, documenting your decisions. Here are some things to keep in mind during your model building process:
# 
# 1. *What do you want to measure*? Make sure you identify one, or a few, variables that will allow you to derive conclusions relevant to your research question, and include those variables in all model specifications. How are the variables that you will be modeling distributed? Provide enough context and information about your data for your audience to understand whatever model results you will eventually present. 
# 2. What [covariates](https://en.wikipedia.org/wiki/Dependent_and_independent_variables#Statistics_synonyms) help you achieve your modeling goals? Are there problematic covariates?  either due to *collinearity*, or because they will absorb some of a causal effect you want to measure?
# 3. What *transformations*, if any, should you apply to each variable? These transformations might reveal linearities in the data, make our results relevant, or help us meet model assumptions.
# 4. Are your choices supported by exploratory data analysis (*EDA*)? You will likely start with some general EDA to *detect anomalies* (missing values, top-coded variables, etc.). From then on, your EDA should be interspersed with your model building. Use visual tools to *guide* your decisions. You can also leverage statistical *tests* to help assess whether variables, or groups of variables, are improving model fit.
# 
# At the same time, it is important to remember that you are not trying to create one perfect model. You will create several specifications, giving the reader a sense of how robust (or sensitive) your results are to modeling choices, and to show that you're not just cherry-picking the specification that leads to the largest effects.
# 
# At a minimum, you need to estimate at least three model specifications: 
# 
# The first model you include should include *only the key variables* you want to measure. These variables might be transformed, as determined by your EDA, but the model should include the absolute minimum number of covariates (usually zero or one covariate that is so crucial it would be unreasonable to omit it).
# 
# Additional models should each be defensible, and should continue to tell the story of how product features contribute to product success. This might mean including additional right-hand side features to remove omitted variable bias identified by your casual theory; or, instead, it might mean estimating a model that examines a related concept of success, or a model that investigates a heterogeneous effect. These models, and your modeling process should be defensible, incremental, and clearly explained at all points.
# 
# Your goal is to choose models that encircle the space of reasonable modeling choices, and to give an overall understanding of how these choices impact results.
```

## 3.1 Base Model: Female indicator and Gross Earnings
In order to answer our research question, we build our first model with 'Gross earnings' as our outcome variable and 'Female Indicator' as our feature variable. A female indicator is a binary flag which has the value of 0 or 1. When it is '1', it means that the lead actor of that movie is a female. We generate this indicator by processing the 'gender' data and add a new column in the dataset to store the resulting indicator. We also include the 'Budget' variable since it has strong correlation with Gross.
\
Moreover, since the Gross earning and Budget are highly skewed, we also apply Log transformation to them in our first model.
\
\
_Log(Gross Adjusted for Inflation) = Female_indicator + Log(Budget Adjusted for Inflation)_
\

## 3.2 Second Model: Adding Genre Indicators
For the second model, we add explanatory variables that reduce effect caused by the female_indicator variable. We suspect that genre might have correlation with the gender of the lead actor. By introducing genre indicators, they should reduce female_indicator's effect on gross earnings.
\
\
_Log(Gross Adjusted for Inflation) = Female_indicator + Log(Budget Adjusted for Inflation) + Is_Genre_Action + Is_Genre_Comedy + Is_Genre_Drama + Is_Genre_Adventure + Is_Genre_Biography + Is_Genre_Animation + Is_Genre_Horror_
\


## 3.3 Third Model: Adding Title Similarity and Movie Duration Indicator
We are also interested to find out if the movie title and movie duration have effects on gross earning. We suspect that title similarity and movie duration might affect the gross earnings. Therefore, we added this "max_title_similarity" score as a control variable, along with another indicator "is_longer_than_2hrs" to our third model to try improve the R-square of the model.
\
\
_Log(Gross Adjusted for Inflation) = Female_indicator + Log(Budget Adjusted for Inflation) + Is_Genre_Action + Is_Genre_Comedy + Is_Genre_Drama + Is_Genre_Adventure + Is_Genre_Biography + Is_Genre_Animation + Is_Genre_Horror_
\

## 3.3 Robust Standard Errors
Our dataset is not IID, which will be explained in the "Limitations of your Model" section. Therefore, our models are built based on robust standard errors.


\newpage

# 4. Results

```{r warning=FALSE, message=FALSE, echo=FALSE, results='asis'}

model_1 <- lm(log(adj_gross) ~ female_indicator + log(adj_budget), movies_dataset)

model_2 <- lm(log(adj_gross) ~ female_indicator + log(adj_budget) + is_genre_action + is_genre_comedy + is_genre_drama + is_genre_adventure + is_genre_biography + is_genre_animation + is_genre_horror, movies_dataset)

model_3 <- lm(log(adj_gross) ~ female_indicator + log(adj_budget) +  is_genre_action + is_genre_comedy + is_genre_drama + is_genre_adventure + is_genre_biography + is_genre_animation + is_genre_horror + max_title_similarity + is_longer_than_2hrs, movies_dataset)

stargazer(
  model_1,
  model_2,
  model_3,
  # model_4,
  header=FALSE,
  type='latex',
  se = list(get_robust_se(model_1), get_robust_se(model_2), get_robust_se(model_3) )
  )

```

In the first model, we see that the p-value of the "Female_indictor" is less than 0.01 which means there is significant evidence that female gender has effects on "Log(Adj Gross)". The coefficient is a positive value, meaning that a movie with a female lead actor actually brings more gross earnings than a movie with a male lead actor. The coefficient value of -0.124 means that it will be 12% more on gross if a movie uses a female lead actor. The adjusted R-squared is 0.493, mainly because the variable 'Budget' we added to this model can explain almost half of the model.

After introducing the genre indicators into our second model, most of them have a p-value less that 0.01, except for "is_genre_drama". Coefficients for both female_indicator and budget have been reduced, but remain significant.Adjusted R-square of the model has also improved to 0.505.

For our third model, the variable "max_title_similarity" and "is_longer_than_2hrs" both have low p-values, showing evidence that they also have effects on the gross earnings. P-values for female indicator remains signifcant. Adjusted R-square of the model has also improved to 0.518.


```{r warning=FALSE, message=FALSE, echo=FALSE,}
# You should display all of your model specifications in a regression table, using a package like [`stargazer`](https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf) to format your output. It should be easy for the reader to find the coefficients that represent key effects near the top of the regression table, and scan horizontally to see how they change from specification to specification. Make sure that you display the most appropriate standard errors in your table.
# 
# In your text, comment on both *statistical significance and practical significance*. You may want to include statistical tests besides the standard t-tests for regression coefficients. Here, it is important that you make clear to your audience the practical significance of any model results. How should the product change as a result of what you have discovered? Are there limits to how much change you are proposing? What are the most important results that you have discovered, and what are the least important? 
```


# 5. Limitations of your Model 

## 5.1 Large-Sample Assumptions
Since our analysis is based on a dataset with more than 5000 entries, we can use the large-sample assumptions.

### 5.1.1 Independent and Identically Distributed (I.I.D.)
Our dataset doesn't satisfy the IID assumption. Our dataset has movies between year 1980 and 2020 scraped from IMDb. For movies that are actually in the same series, like 'Star Wars' or "Mission Impossible", their data will not be independent. Our analysis is based on robust standard errors which can adjust for dependencies issue in our dataset.

### 5.1.2 Unique BLP Exists
We want to make sure that no variables are perfectly collinear with any one of the other variables. From the correlation heatmap below, we can see that perfect collinearity only happens at the diagonal of the matrix which has all 1's and no where else. Also, while building our model, R didn't drop any variables considered to cause perfect collinearity with any other variables.

\
\
```{r warning=FALSE, message=FALSE, echo=FALSE,}

movies_dataset_model <- movies_dataset[, c("gross", "budget", "female_indicator", "max_title_similarity", "runtime", "year")]

movies_cor <- cor(movies_dataset_model)
movies_cor<-round(movies_cor,2)
# movies_cor

library(reshape2)
melted_movies_cor <- melt(movies_cor)

library(ggplot2)
ggplot(data = melted_movies_cor, aes(x=Var1, y=Var2, fill=value)) +
  geom_tile() + 
  scale_fill_gradient(low = "grey", high = "black") +
  geom_text(aes(Var2, Var1, label = value), color = "white", size = 6) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=1), axis.title.x=element_blank(), axis.title.y=element_blank()) + 
  ggtitle("Correlation Heatmap")
```


```{r warning=FALSE, message=FALSE, echo=FALSE,}
# As a team, evaluate all of the large sample model assumptions. However, you do not necessarily want to discuss every assumption in your report. Instead, highlight any assumption that might pose significant problems for your analysis. For any violations that you identify, describe the statistical consequences. If you are able to identify any strategies to mitigate the consequences, explain these strategies. 
# 
# Note that you may need to change your model specifications in response to violations of the large sample model. 
```

\newpage

## 5.2 Omitted Variables

### 5.2.1 Intentional Omitted Variables

![Intentional Omitted Variables]("omitted_variables.png")

The variables that are available in our dataset but are omitted in building our models are:

* Genre
* Director
* Writer
* Production Company
* Lead Actor
* Country
* Release year
* IMDb rating
* Number of votes in IMDb

Our EDA shows that these variables have low correlation with Gross earnings, so we simply omit them in our models. For "Release year", since we already adjusted our Gross and Budgets with inflation, so we didn't include year as a variable that could affect the model outcomes.

### 5.2.2 Unintentional Omitted Variables

```{r warning=FALSE, message=FALSE, echo=FALSE,}
# What are the most important *omitted variables* that you were not able to measure and include in your analysis? For each variable you name, you should *reason about the direction of bias* caused by omitting this variable and whether the omission of this variable calls into question the core results you are reporting. What data could you collect that would resolve any omitted variables bias? 
```

There are other variables not available in our dataset that might have causal effects on a movie's gross earnings.

* Film distribution platforms: We don't have data to tell us what platforms (theaters, streaming, etc) the movies were released on. If a movie was released to more platforms, there are more chance to make money from different audience.
* In theater duration:  We don't have data to tell us how long the movies have been on the distributon platforms. The longer a movie is on, the more time it can make more money.
* Story of the movie: How good is the story is subjective and hard to quantify. We don't have data on that but it could be a big factor on gross. A good movie could mean that people are willing to pay to watch couple more times, or purchase it and put it into their collection.
* Acting skills of the cast: Acting skills could be subjective and hard to quantify, but could affect how people willing to pay for the movies.
* World population: Population grows over the years, and more population means more people paying for movies.


# 6. Conclusion

```{r warning=FALSE, message=FALSE, echo=FALSE,}
# Make sure that you end your report with a discussion that distills key insights from your estimates and addresses your research question. 
```
In conclusion, our analysis shows strong evidence that a female lead actor brings more gross revenue to a movie than a male lead actor. In this case, it is about 14% more on average. The "Max Title Similarity" score also seems to have positive effects on the Gross. The score value is between 0 and 1. When it is 1 (high similarity), it will improve gross earnings by a massive 67%. The indicator on whether a movie is longer than 2 hours also shows a significant effect on gross, bringing in 34% more gross if is longer than 2 hours.



